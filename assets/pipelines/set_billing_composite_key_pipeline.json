PUT _ingest/pipeline/set_billing_composite_key
{
  "description": "Billing Transform: Set composite_key from @timestamp and deployment_id",
  "processors": [
    {
      "script": {
        "lang": "painless",
        "source": """
          if (ctx['@timestamp'] != null) {
              ctx.composite_key = ZonedDateTime.parse(ctx['@timestamp']).toLocalDate().toString() + '_' + ctx.deployment_id;
          }
        """
      }
    }
  ]
}